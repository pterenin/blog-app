{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport { useQuery, useMutation } from '@apollo/client';\nimport { GET_POSTS, CREATE_POST, UPDATE_POST, DELETE_POST } from \"../querirs/queries\";\nconst usePostManagement = () => {\n  _s();\n  const [show, setShow] = useState(false);\n  const [page, setPage] = useState(1);\n  const [editedPost, setEditedPost] = useState(undefined);\n  const [totalCount, setTotalCount] = useState(0);\n  const [postList, setPostList] = useState([]);\n  const {\n    loading,\n    error,\n    data,\n    fetchMore\n  } = useQuery(GET_POSTS, {\n    variables: {\n      options: {\n        paginate: {\n          page: page,\n          limit: 20\n        }\n      }\n    }\n  });\n  const [createPost, {\n    data: createPostData,\n    loading: createPostLoading,\n    error: createPostError\n  }] = useMutation(CREATE_POST);\n  const [deletePost, {\n    loading: deleting,\n    error: deleteError\n  }] = useMutation(DELETE_POST, {\n    onCompleted: () => {}\n  });\n  const [updatePost, {\n    loading: updating,\n    error: updateError\n  }] = useMutation(UPDATE_POST);\n  useEffect(() => {\n    var _data$posts;\n    if (data !== null && data !== void 0 && (_data$posts = data.posts) !== null && _data$posts !== void 0 && _data$posts.data) {\n      setPostList([...postList, ...data.posts.data]);\n      setTotalCount(data.posts.meta.totalCount);\n    }\n  }, [data, loading]);\n  const handleDelete = async deleingPost => {\n    const updatedPosts = postList.map(post => post.id === deleingPost.id ? {\n      ...post,\n      updating: true\n    } : post);\n    setPostList(updatedPosts);\n    try {\n      const result = await deletePost({\n        variables: {\n          id: deleingPost.id\n        }\n      });\n      setPostList(postList.filter(p => p.id != deleingPost.id));\n    } catch (e) {\n      console.error(e);\n    }\n  };\n  const handleUpdatePost = async (title, body) => {\n    if (!editedPost) return;\n    const updatedPosts = postList.map(post => post.id === editedPost.id ? {\n      ...post,\n      updating: true\n    } : post);\n    setPostList(updatedPosts);\n    try {\n      await updatePost({\n        variables: {\n          id: editedPost.id,\n          input: {\n            title,\n            body\n          }\n        }\n      });\n      const updatedPosts = postList.map(post => post.id === editedPost.id ? {\n        id: editedPost.id,\n        title,\n        body\n      } : post);\n      setPostList(updatedPosts);\n    } catch (e) {\n      console.error(e);\n    }\n  };\n  const fetchNextPage = () => {\n    const newPage = page + 1;\n    setPage(newPage);\n    fetchMore({\n      variables: {\n        options: {\n          paginate: {\n            page: newPage,\n            limit: 20\n          }\n        }\n      }\n    });\n  };\n  const savePendig = async () => {\n    const pendingPosts = postList.filter(post => {\n      return !post.id;\n    });\n    try {\n      for (const post of pendingPosts) {\n        const response = await createPost({\n          variables: {\n            input: post\n          }\n        });\n        const createdPostId = response.data.createPost.id;\n        post.id = createdPostId + Date.now();\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  };\n  return {\n    show,\n    setShow,\n    page,\n    setPage,\n    editedPost,\n    setEditedPost,\n    totalCount,\n    setTotalCount,\n    postList,\n    setPostList,\n    createPost,\n    deletePost,\n    updatePost,\n    fetchMore,\n    handleDelete,\n    handleUpdatePost,\n    fetchNextPage,\n    savePendig\n  };\n};\n_s(usePostManagement, \"gVKZjlN3scPzRBTJPm/g7xrkttY=\", false, function () {\n  return [useQuery, useMutation, useMutation, useMutation];\n});\nexport default usePostManagement;","map":{"version":3,"names":["useState","useEffect","useQuery","useMutation","GET_POSTS","CREATE_POST","UPDATE_POST","DELETE_POST","usePostManagement","_s","show","setShow","page","setPage","editedPost","setEditedPost","undefined","totalCount","setTotalCount","postList","setPostList","loading","error","data","fetchMore","variables","options","paginate","limit","createPost","createPostData","createPostLoading","createPostError","deletePost","deleting","deleteError","onCompleted","updatePost","updating","updateError","_data$posts","posts","meta","handleDelete","deleingPost","updatedPosts","map","post","id","result","filter","p","e","console","handleUpdatePost","title","body","input","fetchNextPage","newPage","savePendig","pendingPosts","response","createdPostId","Date","now"],"sources":["/Users/pavelterenin/workspace/blog-app/src/hooks/usePostManagement.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { useQuery, useMutation } from '@apollo/client';\nimport { GET_POSTS, CREATE_POST, UPDATE_POST, DELETE_POST } from \"../querirs/queries\"\nimport { Post } from '../Types/types';\n\nconst usePostManagement = () => {\n  const [show, setShow] = useState(false);\n  const [page, setPage] = useState(1);\n  const [editedPost, setEditedPost] = useState<Post | undefined>(undefined);\n  const [totalCount, setTotalCount] = useState(0);\n  const [postList, setPostList] = useState<Post[]>([]);\n\n  const { loading, error, data, fetchMore } = useQuery(GET_POSTS, {\n    variables: {\n      options: {\n        paginate: {\n          page: page,\n          limit: 20\n        }\n      }\n    }\n  });\n  const [createPost, { data: createPostData, loading: createPostLoading, error: createPostError }] = useMutation(CREATE_POST);\n  const [deletePost, { loading: deleting, error: deleteError }] = useMutation(DELETE_POST, {\n    onCompleted: () => {\n    }\n  });\n  const [updatePost, { loading: updating, error: updateError }] = useMutation(UPDATE_POST);\n\n  useEffect(() => {\n    if (data?.posts?.data) {\n      setPostList([...postList, ...data.posts.data]);\n      setTotalCount(data.posts.meta.totalCount);\n    }\n  }, [data, loading]);\n\n\n\n  const handleDelete = async (deleingPost: Post) => {\n    const updatedPosts = postList.map(post =>\n      post.id === deleingPost.id ? { ...post, updating: true } : post\n    );\n    setPostList(updatedPosts);\n    try {\n      const result = await deletePost({ variables: { id: deleingPost.id } });\n      setPostList(postList.filter(p => p.id != deleingPost.id));\n\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  const handleUpdatePost = async (title: string, body: string) => {\n    if (!editedPost) return;\n    const updatedPosts = postList.map(post =>\n      post.id === editedPost.id ? { ...post, updating: true } : post\n    );\n    setPostList(updatedPosts);\n    try {\n      await updatePost({\n        variables: {\n          id: editedPost.id,\n          input: { title, body }\n        }\n      });\n      const updatedPosts = postList.map(post =>\n        post.id === editedPost.id ? { id: editedPost.id, title, body } : post\n      );\n      setPostList(updatedPosts);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  const fetchNextPage = () => {\n    const newPage = page + 1;\n    setPage(newPage);\n    fetchMore({\n      variables: {\n        options: {\n          paginate: {\n            page: newPage,\n            limit: 20\n          }\n        }\n      }\n    })\n  };\n\n  const savePendig = async () => {\n    const pendingPosts = postList.filter(post => { return !post.id });\n    try {\n      for (const post of pendingPosts) {\n        const response = await createPost({\n          variables: {\n            input: post\n          }\n        });\n        const createdPostId = response.data.createPost.id;\n        post.id = createdPostId + Date.now();\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  return {\n    show, setShow,\n    page, setPage,\n    editedPost, setEditedPost,\n    totalCount, setTotalCount,\n    postList, setPostList,\n    createPost, deletePost, updatePost,\n    fetchMore, handleDelete, handleUpdatePost, fetchNextPage, savePendig\n  };\n};\n\nexport default usePostManagement;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}